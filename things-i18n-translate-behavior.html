<script>

window.Things = window.Things || {};

/**
 * I18n 기본 메시지 Behavior. msgid로 부터 메시지를 translate한다.
 *
 * @polymerBehavior Things.I18nTranslateBehavior
 */
Things.I18nTranslateBehavior = {

  ready: function() {
    if(!Things.DataGlobal.t) {
      Things.DataGlobal.t = this.i18nTranslate;
    }
  },
  
  /**
   * i18n Language Set에서 메시지 아이디로 메시지를 찾는다.
   *
   * @param {string=} msgId Optional message id to lookup. If left off,
   * the instance's `msgid` property is used.
   * 
   * @param {Object=} dataSet 검색하는 Message중에서 대체해야하는 변수를 key:Value 형태로 
   * 전송하여 msg내 해당 되는 Key와 같은 변수가 있으면 replace 없으면 아무작업하지 않음.
   * 
   * @return {string|null} a message in the current locale. Translated message or `null` if not found, 
   */
  i18nTranslate: function(msgId, dataSet) {
    Things.DataGlobal.locale?null:Things.DataGlobal.locale='en-US';

    if(!msgId || !Things.DataGlobal || !Things.DataGlobal.locales || !Things.DataGlobal.locale) {
      return msgId;
    }

    var langSet = Things.DataGlobal.locales[Things.DataGlobal.locale];
    var message = langSet[msgId];

    if (langSet && message) {
      if(!dataSet) {
        return message;

      } else {
        Object.keys(dataSet).forEach(function(data) {
          var bracedData = '{' + data.replace(/\$/, '\\$') + '}';
          var regEx = new RegExp(bracedData, "gi");
          message = message.replace(regEx, dataSet[data]);
        });

        return message;
      }
    } else {
      var warnMsg = this.localName ? this.localName + ': msgid (' : '(';
      warnMsg += this.msgid + ') was not found!'
      console.warn(warnMsg);
      return msgId;
    }
  }

};

</script>
